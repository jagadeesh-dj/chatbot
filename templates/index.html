<!DOCTYPE html>
<html lang="en">
  {% load static %}
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chatbot</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="{% static 'style.css' %}">

</head>
<body>
  <div id="container">
        <div id="chatbot-heading">
          <h2>Tutorial ChatBot</h2>
        </div>
        <div id="messages">  
          <table id="chatbot">
            <tr id="user" >
              <td >
    
              </td>
            </tr>
            <tr id="bot">
              <td>
    
              </td>
            </tr>
          </table>
        </div>  
        <div id="form">
          <form action="" method="POST" autocomplete="off">
            {% csrf_token %}
            <div style="display: flex;text-align: center;">
              <div>
                <input type="text" name="message" id="msg" placeholder="enter message">
      
              </div>
              <div>
                <button id="btn"><i class="fa-solid fa-paper-plane"></i></button>
      
              </div>
          
            </div>
              
          </form>
        </div>
    
  </div>

  <script>

    document.addEventListener("DOMContentLoaded",(e)=>{
      let date=new Date()

      input=document.getElementById('msg')
      bot=document.getElementById('bot')
      btn=document.querySelector('#btn')
      chatbot=document.getElementById('chatbot')
      btn.addEventListener('click',(e)=>{
        e.preventDefault()
        if(input.value === ""){
          return
        }
        else{

        
        let store=window.localStorage
        input_val=input.value
        store.setItem("user",input_val)
        let tr=document.createElement('tr')
        let td=document.createElement('td')
        let small=document.createElement('small')
        tr.appendChild(td)
        tr.appendChild(small)
        chatbot.appendChild(tr)
        td.textContent=input_val
        small.innerHTML=date.getHours()+":"+date.getMinutes()
        td.style.backgroundColor="lightblue"
        td.style.width='fit-content'
        td.style.padding="1rem 1rem"
        tr.style.float="right"
        tr.style.display='flex'
        small.style.marginLeft="10px"
        td.style.borderRadius="10px"
        scroll()
        fetch('/chatbot/'+input_val+'/',{
          method:'GET',
        })
        .then(res=>res.json())
        .then(data=>{
          let tr=document.createElement('tr')
          let td=document.createElement('td')
          tr.appendChild(td)
          chatbot.appendChild(tr)
          datas=data.res
          td.textContent=datas
          td.style.backgroundColor="lightgreen"
          td.style.width='fit-content'
          td.style.padding="1rem 1rem"
          td.style.borderRadius="10px"
          td.style.float="left"
          scroll()

        })
      }
        input.value=""
      })
    
     
    });
    console.log(window.localStorage.length)

    function scroll(){
      const scro=document.getElementById('messages')
        scro.scrollTop=scro.scrollHeight
    }
   
    
  </script>
</body>
</html>
